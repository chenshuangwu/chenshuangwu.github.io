---
title: 微信公众号开发
date: 2019-07-23 15:08:18
tags: 微信公众号
---
### 微信公众号的二次开发

微信公众号是微信里面的一个强大的功能，微信是张小龙一手创办的。

微信公众号和微信小程序是微信平台化的战略部署。

微信公众号需要用户去关注，在微信公众号里可以做一些消息的推送等等之类的业务，最重要的是微信公众号中提供了二次开发的api，比如可以在微信公众号中嵌入webapp，所以我们作为H5开发工程师需要关注的就是在微信公众号的二次开发中如何开发嵌入在其中的webapp

webapp的开发不需要研究了，我们需要真正掌握的技术是什么？

嵌入到微信公众号中的webapp和普通的在手机浏览器中的打开的webapp是有区别的，区别就是微信公众号中的webapp可以调用微信中的JS-SDK来调用微信、设备的原生功能。

在混合开发的学习中，我们了解到，在手机浏览器中的普通的webapp是受浏览器安全级别限制的，无法调用设备原生功能，但是当webapp嵌入到微信公众号中，webapp页面就可以和微信这个native应用进行交互了，微信提供了JS-SDK来做这一点，所以页面可以调用JSSDK，就可以去调用微信、设备的原生功能了。

所以我们需要掌握的是就是当页面被嵌入到微信公众号之后，如何调用JS-SDK。

<!--more-->
#### JS-SDK

SDK是指软件开发工具包,JS-SDK指的是专门为JS调用所开发的工具包，里面已经定义好了很多的工具api，供webapp中的js调用。

JS-SDK中有很多的微信自己的功能，比如微信扫一扫、微信支付等等，还有一些微信二次处理的调用设备原生的功能，比如：相机、相册、通讯录。


如何调用JSSDK？我们先去了解一下微信公众号二次开发。

在微信公众平台可以申请订阅号和服务号这两种账号，订阅号更像电子杂志，每天都可以给用户发送一条信息（图文、视频、语音），存在于聊天界面的订阅号文件夹中。服务号顾名思义，专门为用户提供服务的，所以它的消息推送能力较弱，一个月只能推送4条，存在在聊天界面，就像一个好友一样。

在企业中，微信公众号的大部分日常管理都是由运营人员来做的，我们需要的做的事情在[开发文档](https://mp.weixin.qq.com/wiki?t=resource/res_main&id=mp1445241432)中有体现.





#### JSSDK的调用

我们准备使用一个测试页面来学习如何调用JSSDK，首先利用weui开发了一个简单的只有按钮的测试页面

> 微信官方提供了[weui样式库](https://weui.io/)供我们在开发webapp的时候使用，里面集成了很多基于微信样式开发的组件。

接下来开始在示例页面中调用JSSDK：

1. 在需要调用JSSDK的页面引入js文件

    http://res.wx.qq.com/open/js/jweixin-1.2.0.js

2. 进行权限验证

注意，权限验证是根据url地址，因为url地址会放入到验证信息中，如果访问页面的url和验证信息中的url对不上的话，就调用失败了，所以一个url就需要配置一次，如果使用vue这一的单页面应用的话，因为html只有一个，但是路由跳转的时候网页的url其实是在不断变化的(history mode)，所以需要每个路由跳转之后都要重新配置一次（需要调用jssdk的路由）

wx.config({
    debug: true, // 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。
    appId: '', // 必填，公众号的唯一标识
    timestamp: , // 必填，生成签名的时间戳
    nonceStr: '', // 必填，生成签名的随机串
    signature: '',// 必填，签名
    jsApiList: [] // 必填，需要使用的JS接口列表
});

在其中我们需要传入一些参数，其中有一些叫做签名的参数, 签名是一个sha1加密之后的字符串，包含着时间、要调用jssdk的页面的url、临时票据（jsapi_ticket），但是签名只能是服务端进行计算（基于安全考虑），所以需要去和后端请求这些参数。

还需要在jsApiList中写入我们想要调用的接口


jsApiList: [
    'scanQRCode',
    'chooseImage'
]



3. 权限验证成功之后进行接口的调用

jssdk中提供了wx.ready的api，里面的回调函数会在权限配置完成后执行

wx.ready(function(){
    // config信息验证后会执行ready方法，所有接口调用都必须在config接口获得结果之后，config是一个客户端的异步操作，所以如果需要在页面加载时就调用相关接口，则须把相关接口放在ready函数中调用来确保正确执行。对于用户触发时才调用的接口，则可以直接调用，不需要放在ready函数中。
});

4. 调用JSSDK中接口

在文档中有很多调用功能的接口供我们使用了。



开发完成页面之后，其实webapp是要运行在服务器中的，而且是本公司自己的服务器，然后我们就需要讲本公司的服务器中的webapp嵌入到微信公众号中，需要做一些配置，比如，需要告诉公众号，服务器是哪个服务器，需要将webapp对应的域名配置成js安全域名，这样的话，webapp才能调用相关的JSSDK。



